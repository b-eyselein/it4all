@import model.tools.programming.{ProgCollection, ProgExParts, ProgExercise, ProgToolMain, ProgUserTestData}

@(user: model.User, collection: ProgCollection, exercise: ProgExercise, oldData: Seq[ProgUserTestData], toolMainObject: ProgToolMain)(
    implicit requestHeader: RequestHeader, messagesProvider: MessagesProvider
)

@stdTestSize = @{
    ProgToolMain.standardTestCount
}

@scripts = {
    <script src="@routes.Assets.versioned("lib/systemjs/dist/system.js")"></script>
    <script type='text/javascript' src="@routes.Assets.versioned("systemjs.config.js")"></script>

    <script>
            SystemJS.import('@routes.Assets.versioned("app/programming/testdataCreation.js")');
    </script>
}

@testInputNameAndId(id: Int, testCount: Int) = @{
    s"inp_${id}_$testCount"
}

@testInputPlaceholder(id: Int, testCount: Int) = @{
    s"Test ${testCount + 1}, Input ${id + 1}"
}

@testOutputPlaceholder(id: Int) = @{
    s"Test ${id + 1}, Output "
}

@correctionUrl = @{
    coll.routes.CollectionController.correctLive(toolMainObject.urlPart, collection.id, exercise.id, ProgExParts.TestdataCreation.urlName)
}

@main("Programmierung: Defintion von Testdaten", Some(user), scripts) {

    @core.helperTemplates.modal("Bearbeitungshinweise", "hintsModal", "lg") {
        <ul>
            <li>Hier können Sie sich eigene Testdaten definieren, um die Funktion kennenzulernen und zusätzliche Testdaten zu nutzen.</li>
            <li>Diese können gegen eine Musterlösung validiert werden.</li>
            <li>Außerdem werden Sie automatisch beim Testen ihrer Lösung verwendet.</li>
        </ul>
    }

    <div class="container">
        <h1>Definition von Testdaten <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#hintsModal">
            ?</button></h1>

        <div class="row">
            <div class="col-md-6">
                <h3>Beschreibung der Funktion</h3>

                <div >@Html(exercise.text)</div>

                <hr>

                <div class="btn-group d-flex">
                    <button data-href="@correctionUrl" id="testBtn" class="btn btn-success w-100">
                        Testdaten validieren & speichern</button>
                    <a class="btn btn-secondary w-100" href="@coll.routes.CollectionController.index(toolMainObject.urlPart)">
                        Bearbeitung beenden</a>
                </div>

                <div id="messageDiv"></div>

            </div>

            <div class="col-md-6">

                @helper.CSRF.formField

                <input title="hidden" hidden id="inputCount" value="@exercise.inputCount">

                <input title="hidden" hidden type="number" name="inputCount" id="inputCount" value="@exercise.inputCount">
                <input title="hidden" hidden type="number" name="testCount" id="testCount" value="@Math.max(oldData.size, stdTestSize)">

                <table class="table" id="testDataTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            @for(i <- 1 to exercise.inputCount) {
                                <th>Input @i</th>
                            }
                            <th>Output</th>
                        </tr>
                    </thead>

                    <tbody id="testDataBody">
                        @for(old <- oldData) {
                            <tr id="tr_@old.id" data-testid="@old.id">
                                <td>@old.id</td>
                                <textarea>@old.inputAsJson</textarea>
                                <td>
                                    <input class="form-control" value="@old.output" name="outp_@old.id" id="outp_@old.id"
                                    placeholder="@testOutputPlaceholder(old.id)">

                                </td>
                            </tr>
                        }
                        @for(testCount <- oldData.size until stdTestSize) {
                            <tr id="tr_@testCount" data-testid="@testCount">
                                <td>@testCount</td>
                                @for(inputCount <- 0 until exercise.inputCount) {
                                    <td>
                                        <input class="form-control" name="@testInputNameAndId(inputCount, testCount)" id="@testInputNameAndId(inputCount, testCount)"
                                        placeholder="@testInputPlaceholder(inputCount, testCount)">
                                    </td>
                                }
                                <td><input class="form-control" name="outp_@testCount" id="outp_@testCount" placeholder="@testOutputPlaceholder(testCount)">
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>

                <hr>

                <button class="btn btn-secondary btn-block" id="moreTestDataBtn">
                    <span class="octicon octicon-plus"></span> Weitere Testdaten erstellen
                </button>

            </div>


        </div>
    </div>
}
