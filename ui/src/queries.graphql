# /registerForm

mutation Register($username: String!, $firstPassword: String!, $secondPassword: String!) {
  register(registerValues: {username: $username, firstPassword: $firstPassword, secondPassword: $secondPassword})
}

# /loginForm

fragment LoggedInUserWithToken on LoggedInUserWithToken {
  loggedInUser {
    username
    isAdmin
  }
  jwt
}

mutation Login($username: String!, $password: String!) {
  login(credentials: {username: $username, password: $password}) {
    ...LoggedInUserWithToken
  }
}

# /tools

fragment CollectionTool on CollectionTool {
  id
  name
  state
  collectionCount
  lessonCount
  exerciseCount
}

query ToolOverview($userJwt: String!) {
  me(userJwt: $userJwt) {
    tools {
      ...CollectionTool
    }
  }
}

# /tools/:toolId
query CollectionToolOverview($userJwt: String!, $toolId: String!) {
  me(userJwt: $userJwt) {
    tool(toolId: $toolId) {
      name
      collectionCount
      exerciseCount
      lessonCount
      proficiencies {
        ...UserProficiency
      }
    }
  }
}

fragment UserProficiency on UserProficiency {
  topic {
    ...Topic
  }
  points
  pointsForNextLevel
  level {
    ...Level
  }
}

# /tools/:toolId/allExercises
query AllExercisesOverview($userJwt: String!, $toolId: String!) {
  me(userJwt: $userJwt) {
    tool(toolId: $toolId) {
      allExercises {
        topicsWithLevels {
          ...TopicWithLevel
        }
        ...FieldsForLink
      }
    }
  }
}

# /tools/:toolId/collections

fragment CollectionValues on ExerciseCollection {
  collectionId
  title
  exerciseCount
}

query CollectionList($userJwt: String!, $toolId: String!) {
  me(userJwt: $userJwt){
    tool(toolId: $toolId) {
      name
      collections {
        ...CollectionValues
      }
    }
  }
}

# /tools/:toolId/collections/:collId
query CollectionOverview($userJwt: String!, $toolId: String!, $collId: Int!) {
  me(userJwt: $userJwt){
    tool(toolId: $toolId) {
      collection(collId: $collId) {
        title
        exercises {
          ...FieldsForLink
        }
      }
    }
  }
}

# /tools/:toolId/collections/:collId/exercises/:exId
query ExerciseOverview($userJwt: String!, $toolId: String!, $collId: Int!, $exId: Int!) {
  me (userJwt: $userJwt) {
    tool(toolId: $toolId) {
      collection(collId: $collId) {
        exercise(exId: $exId) {
          exerciseId
          title
          text
          parts {
            ...Part
          }
        }
      }
    }
  }
}

# /tools/:toolId/collections/:collId/exercises/:exId/parts/:part

fragment ExerciseSolveFields on Exercise {
  exerciseId
  collectionId
  toolId
  title
  text
  programmingContent {
    ...ProgExerciseContentSolveFields
  }
  regexContent {
    ...RegexExerciseContentSolveFields
  }
  sqlContent {
    ...SqlExerciseContentSolveFields
  }
  umlContent {
    ...UmlExerciseContentSolveFields
  }
  webContent {
    ...WebExerciseContentSolveFields
  }
  xmlContent {
    ...XmlExerciseContentSolveFields
  }
}

query Exercise($userJwt: String!, $toolId: String!, $collId: Int!, $exId: Int!, $partId: String!) {
  me (userJwt: $userJwt) {
    tool(toolId: $toolId) {
      collection(collId: $collId) {
        exercise(exId: $exId) {
          ...ExerciseSolveFields
        }
      }
    }
  }
}

# Lesson queries

fragment LessonIdentifier on Lesson {
  lessonId
  title
  description
}

# /tools/:toolId/lessons

query LessonsForTool($userJwt: String!, $toolId: String!) {
  me(userJwt: $userJwt) {
    tool(toolId: $toolId) {
      name
      lessons {
        ...LessonIdentifier
      }
    }
  }
}

# /tools/:toolId/lessons/:lessonId

fragment LessonTextContent on LessonTextContent {
  __typename
  contentId
  content
}

fragment LessonMultipleChoiceQuestionAnswer on LessonMultipleChoiceQuestionAnswer {
  id
  answer
  isCorrect
}

fragment LessonMultipleChoiceQuestion on LessonMultipleChoiceQuestion {
  id
  questionText
  answers {
    ...LessonMultipleChoiceQuestionAnswer
  }
}

fragment LessonMultipleChoiceQuestionContent on LessonMultipleChoiceQuestionsContent {
  __typename
  contentId
  questions {
    ...LessonMultipleChoiceQuestion
  }
}

fragment Lesson on Lesson {
  lessonId
  title
  description
  contents  {
    ...on LessonTextContent {
      ...LessonTextContent
    }
    ... on LessonMultipleChoiceQuestionsContent {
      ...LessonMultipleChoiceQuestionContent
    }
  }
}

query Lesson($userJwt: String!,$toolId: String!, $lessonId: Int!) {
  me(userJwt: $userJwt) {
    tool(toolId: $toolId) {
      name
      lesson(lessonId: $lessonId) {
        ...Lesson
      }
    }
  }
}

# Fragments

fragment Level on Level {
  title
  levelIndex
}

fragment Topic on Topic {
  abbreviation
  title
  maxLevel {
    ...Level
  }
}

fragment TopicWithLevel on TopicWithLevel{
  topic {
    ...Topic
  }
  level {
    ...Level
  }
}

fragment Part on ExPart {
  id
  name
  isEntryPart
}

fragment FieldsForLink on Exercise {
  exerciseId
  collectionId
  toolId
  title
  difficulty
  topicsWithLevels {
    ...TopicWithLevel
  }
}

fragment ProgExerciseContentSolveFields on ProgrammingExerciseContent {
  unitTestPart {
    unitTestType
    unitTestFiles {
      ...ExerciseFile
    }
  }
  implementationPart {
    files {
      ...ExerciseFile
    }
  }
  sampleSolutions {
    ...ProgrammingSampleSolution
  }
  part(partId: $partId)
}
fragment ProgrammingSampleSolution on ProgrammingSampleSolution {
  __typename
  sample {
    files {
      ...ExerciseFile
    }
  }
}

fragment RegexExerciseContentSolveFields on RegexExerciseContent {
  sampleSolutions {
    ...RegexSampleSolution
  }
  part(partId: $partId)
}

fragment RegexSampleSolution on RegexSampleSolution {
  __typename
  sample
}

fragment SqlExerciseContentSolveFields on SqlExerciseContent {
  hint
  sampleSolutions {
    ...SqlSampleSolution
  }
  part(partId: $partId)
  sqlDbContents {
    ...SqlQueryResult
  }
}

fragment SqlQueryResult on SqlQueryResult {
  tableName
  columnNames
  rows {
    ...SqlRow
  }
}

fragment SqlRow on SqlRow {
  cells {
    key
    value {
      ...SqlCell
    }
  }
}

fragment SqlCell on SqlCell {
  colName
  content
  different
}

fragment SqlSampleSolution on SqlSampleSolution {
  __typename
  sample
}

fragment UmlExerciseContentSolveFields on UmlExerciseContent {
  toIgnore
  mappings {
    key
    value
  }
  sampleSolutions {
    ...UmlSampleSolution
  }
  part(partId: $partId)
}

fragment UmlSampleSolution on UmlSampleSolution {
  __typename
  sample {
    ...UmlClassDiagram
  }
}

fragment UmlClassDiagram on UmlClassDiagram {
  classes {
    ...UmlClass
  }
  associations {
    ...UmlAssociation
  }
  implementations{
    ...UmlImplementation
  }
}

fragment UmlClass on UmlClass {
  classType
  name
  attributes {
    ... UmlAttribute
  }
  methods {
    ...UmlMethod
  }
}

fragment UmlAttribute on UmlAttribute{
  isAbstract
  isDerived
  isStatic
  visibility
  memberName
  memberType
}

fragment UmlMethod on UmlMethod {
  isAbstract
  isStatic
  visibility
  memberName
  parameters
  memberType
}

fragment UmlAssociation on UmlAssociation {
  assocType
  assocName
  firstEnd
  firstMult
  secondEnd
  secondMult
}

fragment UmlImplementation on UmlImplementation {
  subClass
  superClass
}

fragment WebExerciseContentSolveFields on WebExerciseContent {
  files {
    ...ExerciseFile
  }
  siteSpec {
    fileName
    htmlTasks {
      text
    }
    jsTaskCount
  }
  sampleSolutions {
    ...WebSampleSolution
  }
  part(partId: $partId)
}

fragment WebSampleSolution on WebSampleSolution {
  __typename
  sample {
    files {
      ...ExerciseFile
    }
  }
}

fragment XmlExerciseContentSolveFields on XmlExerciseContent {
  rootNode
  grammarDescription
  sampleSolutions {
    ...XmlSampleSolution
  }
  part(partId: $partId)
}

fragment XmlSampleSolution on XmlSampleSolution {
  __typename
  sample {
    document
    grammar
  }
}

fragment ExerciseFile on ExerciseFile {
  name
  fileType
  content
  editable
}
