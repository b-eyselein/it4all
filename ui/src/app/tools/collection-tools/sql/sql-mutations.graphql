# Db Contents

query DbContents($schemaName: String!) {
  sqlDbContents(schemaName: $schemaName) {
    ...SqlQueryResult
  }
}

# Result fragments

fragment AbstractCorrectionResult on AbstractCorrectionResult {
  solutionSaved
  points
  maxPoints
}

mutation SqlCorrection($collId: Int!, $exId: Int!, $part: SqlExPart!, $solution: String!) {
  correctSql(collId: $collId, exId: $exId,part: $part, solution: $solution) {
    ...SqlIllegalQueryResult
    ...SqlWrongQueryTypeResult
    ...SqlResult
  }
}

fragment SqlIllegalQueryResult on SqlIllegalQueryResult {
  ...AbstractCorrectionResult
  message
}

fragment SqlWrongQueryTypeResult on SqlWrongQueryTypeResult {
  ...AbstractCorrectionResult
  message
}

# Column comparison

fragment ColumnMatch on SqlColumnMatch {
  matchType
  userArg
  sampleArg
}

fragment ColumnComparison on SqlColumnComparisonMatchingResult {
  ...MR
#  allMatches {
#    ...ColumnMatch
#  }
}

# Table comparison

fragment TableMatch on SqlTableMatch {
  matchType
  userArg
  sampleArg
}

fragment TableComparison on SqlTableComparisonMatchingResult {
  ...MR
#  allMatches {
#    ...TableMatch
#  }
}

# JoinExpression / Where Comparison

fragment BinaryExpressionMatch on SqlBinaryExpressionMatch {
  matchType
  userArg
  sampleArg
}

fragment BinaryExpressionComparison on SqlBinaryExpressionComparisonMatchingResult {
  ...MR
#  allMatches {
#    ...BinaryExpressionMatch
#  }
}

# Insert comparison

fragment InsertMatch on SqlInsertMatch {
  matchType
  userArg
  sampleArg
}

fragment InsertComparison on SqlInsertComparisonMatchingResult {
  ...MR
#  allMatches {
#    ...InsertMatch
#  }
}

# Group by comparison

fragment GroupByMatch on SqlGroupByMatch {
  matchType
  sampleArg
  userArg
}

fragment  GroupByComparison on SqlGroupByComparisonMatchingResult {
  ...MR
#  allMatches  {
#    ...GroupByMatch
#  }
}

# Order By comparison

fragment OrderByMatch on SqlOrderByMatch {
  matchType
  sampleArg
  userArg
}

fragment OrderByComparison on SqlOrderByComparisonMatchingResult {
  ...MR
#  allMatches {
#    ...OrderByMatch
#  }
}

# Limit comparison

fragment LimitMatch on SqlLimitMatch {
  matchType
  sampleArg
  userArg
}

fragment LimitComparison on SqlLimitComparisonMatchingResult {
  ...MR
#  allMatches {
#    ...LimitMatch
#  }
}

# Select additional comparisons

fragment SelectAdditionalComparison on SelectAdditionalComparisons {
  groupByComparison {
    ...GroupByComparison
  }
  orderByComparison {
    ...OrderByComparison
  }
  limitComparison {
    ...LimitComparison
  }
}

# Complete result

fragment SqlResult on SqlResult {
  ...AbstractCorrectionResult
  staticComparison {
    columnComparison {
      ...ColumnComparison
    }
    tableComparison {
      ...MR
      ...TableComparison
    }
    joinExpressionComparison {
      ...BinaryExpressionComparison
    }
    whereComparison {
      ...BinaryExpressionComparison
    }
    additionalComparisons {
      selectComparisons {
        ...SelectAdditionalComparison
      }
      insertComparison {
        ...InsertComparison
      }
    }
  }
  executionResult {
    ...SqlExecutionResult
  }
}

fragment SqlExecutionResult on SqlExecutionResult {
  userResultTry {
    ...SqlQueryResult
  }
  sampleResultTry {
    ...SqlQueryResult
  }
}

fragment SqlQueryResult on SqlQueryResult {
  tableName
  columnNames
  rows {
    ...SqlRow
  }
}

fragment SqlRow on SqlRow {
  cells {
    key
    value {
      ...SqlCell
    }
  }
}

fragment SqlCell on SqlCell {
  colName
  content
  different
}

# other fragments

fragment NewMatch on NewMatch {
  matchType
  sampleArgDescription
  userArgDescription
}

fragment MR on MatchingResult  {
  points
  maxPoints
  allMatches {
    ...NewMatch
  }
}
