@(user: model.user.User, exercise: model.exercise.SqlExercise, tables: List[model.SqlQueryResult])

@main("SQL", user) {
<style>
#editor {
	height: 200px;
}
</style>
<script src="@controllers.routes.Assets.versioned("javascripts/ace/ace.js")"></script>
<script src="@controllers.routes.Assets.versioned("javascripts/sqlProcessor.js")"></script>

<script>
  function testSolution() {
    var editorContent = editor.getValue();
    if(editorContent == "") {
      alert("Geben Sie eine Query ein!");
      return;
    }
    
    // AJAX-Objekt erstellen, Callback-Funktion bereitstellen
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if(xhttp.readyState == 4 && xhttp.status == 200) {
        processCorrection(xhttp.responseText);
      }
    };
    
    // AJAX-Objekt mit Daten fuellen, absenden
    var parameters = "editorContent=" + encodeURIComponent(editorContent);
    xhttp.open("PUT", "@controllers.sql.routes.SQL.commit(exercise.key.scenarioName, exercise.key.id)", true);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.setRequestHeader("Accept", "application/json");
    xhttp.send(parameters);
  }

  function prepareFormForSubmitting() {
    document.getElementById("editorContent").value = editor.getValue();
  }
</script>

<div class="container">

  <div class="row row-eq-height">

    <div class="col-md-6">
      <div class="panel panel-default">
        <div class="panel-heading">Aufgabe @exercise.key.id</div>
        <div class="panel-body">
          <p>@exercise.text</p>
        </div>
        <div class="panel-footer">
          <button type="button" class="btn btn-default btn-block" onclick="testSolution();">L&ouml;sung testen</button>
          <input type="submit" class="btn btn-default btn-block disabled" disabled id="commit"
            title="Noch nicht m&ouml;glich. Testen Sie ihre L&ouml;sung erst." value="L&ouml;sung abgeben">
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="panel panel-default">
        <div class="panel-heading">Query</div>
        <div class="panel-body">
          <pre id="editor" class="form-control">select phonenumber from phone</pre>
          <script type="text/javascript">
                      var editor = ace.edit("editor");
                      editor.setTheme("ace/theme/eclipse");
                      editor.setFontSize("14px");
                      editor.getSession().setMode("ace/mode/sql");
                      editor.getSession().setTabSize(2);
                      editor.getSession().setUseSoftTabs(true);
                      editor.getSession().setUseWrapMode(true);
                    </script>
        </div>
      </div>
    </div>

  </div>

  <div id="resultPanel" class="panel panel-default" hidden>
    <div class="panel-heading">Ergebnisse</div>
    <div id="resultDiv" class="panel-body">
      
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      Tabelleninhalte
    </div>
    <div class="panel-body">
      <ul class="nav nav-tabs">
        <li class="active"><a data-toggle="tab" href="#db_scheme">Datenbankschema</a></li>@for(result <- tables) {
        <li><a data-toggle="tab" href="#@result.getTableName()">@result.getTableName()</a></li>}
      </ul>

      <div class="tab-content">
        <div id="db_scheme" class="tab-pane fade in active">
          <img class="img-rounded img-responsive center-block" src="@routes.Assets.versioned("images/sql/phone.png")" alt="Datenbankschema">
        </div>
      
      
      @for(result <- tables) {
        <div id="@result.getTableName()" class="tab-pane fade">
        <table class="table table-responsive table-hover table-bordered">
          <thead>
            <tr>@for(colName <- result.getColumnNames()) {
              <th>@colName</th>}
            </tr>
          </thead>
          <tbody>@for(row <- result.getRows()) {
            <tr>@for(cell <- row) {
              <td>@cell</td>}
            </tr>}
          </tbody>
        </table>
        </div>}
      </div>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">Debug: Musterl&ouml;sungen + Fertige Query in Box!...</div>
    <div class="panel-body">
    @for(sample <- exercise.samples) {
      <pre>@sample.sample</pre>
    }
    </div>
  </div>

</div>
}
